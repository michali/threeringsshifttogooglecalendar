<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Add To Calendar Tests</title>

    <link rel="stylesheet" href="qunit/qunit-1.15.0.css" />
    <script src="qunit/qunit-1.15.0.js"></script>
	<script src="../js/datePrototypeExtensions.js"></script>
    <script src="../js/googleCalendarEvent.js"></script>
	<script src="../js/addToCalendar.js"></script>
    <script>
		var ShiftMock = function() {
			this.startHour = 0;
			this.previousHour = 0;
		};	
	
		function createCalendarLink(shift) {
			var StorageMock = function(){
				this.get = function(data, action){
					var items = {eventSubject:''}; 
					action(items);
				}
			}
			return createAddToGoogleCalendarLink(shift, new StorageMock());
		}
		
		function hrefContains(link, substring){
			return link.href.indexOf(substring) > -1;
		}
		
		test("WeekView_AddToCalendar.WhenShiftRollsByMidnight.ShouldAddEndDateNextDay", function (assert) {
			var shift = new ShiftMock();
			shift.startYear = 2014;
			shift.startMonth = 10;
			shift.startDay = 31;
			shift.startHour = 23;
			shift.endYear = 2014;
			shift.endMonth = 11;
			shift.endDay = 1;
			shift.endHour = 1;
			var calendarLink = createCalendarLink(shift);
			assert.ok(hrefContains(calendarLink, "dates=20141031T230000Z%2F20141101T010000Z"));
		});
		
		test("WeekView_AddToCalendar.WhenShiftIsOnSameDay.EndDayShouldBeSameAsStartDay", function (assert) {
			var shift = new ShiftMock();
			shift.startYear = 2014;
			shift.startMonth = 10;
			shift.startDay = 31;
			shift.startHour = 21;
			shift.endYear = 2014;
			shift.endMonth = 10;
			shift.endDay = 31;
			shift.endHour = 23;
			var calendarLink = createCalendarLink(shift);
			assert.ok(hrefContains(calendarLink, "dates=20141031T210000Z%2F20141031T230000Z"));
		});
		
		test("WeekView_AddToCalendar.WhenShiftIsFirstOfCalendarDayButBeforeEndOfRotaDay.ShiftShouldBePlacedOnNextCalendarDay", function (assert) {
			var shift = new ShiftMock();
			shift.startYear = 2014;
			shift.startMonth = 10;
			shift.startDay = 31;
			shift.startHour = 1;
			shift.endYear = 2014;
			shift.endMonth = 10;
			shift.endDay = 31;
			shift.endHour = 4;
			shift.firstShiftOfDayStartHour = 7;
			var calendarLink = createCalendarLink(shift);
			assert.ok(hrefContains(calendarLink, "dates=20141101T010000Z%2F20141101T040000Z"));
		});
		
		test("WeekView_AddToCalendar.WhenShiftIsAfterMidnightOfCalendarDayButBeforeEndOfRotaDay.ShiftShouldBePlacedOnNextCalendarDay", function (assert) {
			var shift = new ShiftMock();
			shift.startYear = 2014;
			shift.startMonth = 10;
			shift.startDay = 31;
			shift.startHour = 5;
			shift.endYear = 2014;
			shift.endMonth = 10;
			shift.endDay = 31;
			shift.endHour = 6;
			shift.firstShiftOfDayStartHour = 7;
			var calendarLink = createCalendarLink(shift);
			assert.ok(hrefContains(calendarLink, "dates=20141101T050000Z%2F20141101T060000Z"), calendarLink);
		});
    </script>
</head>
<body>
    <div id="qunit"></div>
</body>
</html>