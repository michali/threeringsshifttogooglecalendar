<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Add To Calendar Tests</title>

    <link rel="stylesheet" href="qunit/qunit-1.15.0.css" />
    <script src="qunit/qunit-1.15.0.js"></script>
	<script src="../js/datePrototypeExtensions.js"></script>
    <script src="../js/googleCalendarEvent.js"></script>
	<script src="../js/addToCalendar.js"></script>
    <script>
		var ShiftMock = function(containerWithShiftDateTimeInfoId) {
			this.hourSpanAbbr = "";
			this.previousHourSpanAbbr = "";
		};
		
		function createShiftMockWithId(containerWithShiftDateTimeInfoId){
			var shiftMock = new ShiftMock();
			shiftMock.containerWithShiftDateTimeInfoId = containerWithShiftDateTimeInfoId;
			return shiftMock;
		};
		
	
		function createCalendarLink(shift) {
			var StorageMock = function(){
				this.get = function(data, action){
					var items = {eventSubject:''}; 
					action(items);
				}
			}
			return createAddToGoogleCalendarLink(shift, new StorageMock());
		}
		
		function contains(largerString, substring){
			return largerString.href.indexOf(substring) > -1;
		}
		
		test("AddToCalendar.WhenShiftRollsByMidnight.ShouldAddEndDateNextDay", function (assert) {
			var shift = createShiftMockWithId("week_view_rota_shift_period_day_23_00_01_00_2014_10_31");
			var calendarLink = createCalendarLink(shift);
			assert.ok(contains(calendarLink, "dates=20141031T230000Z%2F20141101T010000Z"));
		});
		
		test("AddToCalendar.WhenShiftIsOnSameDay.EndDayShouldBeSameAsStartDay", function (assert) {
			var shift = createShiftMockWithId("week_view_rota_shift_period_day_21_00_23_00_2014_10_31");
			var calendarLink = createCalendarLink(shift);
			assert.ok(contains(calendarLink, "dates=20141031T210000Z%2F20141031T230000Z"));
		});
		
		test("AddToCalendar.WhenShiftTakesPlaceOnNextCalendarDayButBeforeEndOfRotaDay.ShiftShouldBePlacedOnNextCalendarDay", function (assert) {
			var shift = createShiftMockWithId("week_view_rota_shift_period_day_01_00_04_00_2014_10_31");
			shift.hourSpanAbbr = "01:00 to 04:00";
			shift.previousHourSpanAbbr = "23:00 to 01:00";
			var calendarLink = createCalendarLink(shift);
			assert.ok(contains(calendarLink, "dates=20141101T010000Z%2F20141101T040000Z"));
		});
    </script>
</head>
<body>
    <div id="qunit"></div>
</body>
</html>